<!DOCTYPE html>
<html>
	<head>
		<title>Reactive.coffee demo</title>
		<script type="text/javascript" src="../build/core.js"></script>
		<script type="text/javascript" src="../build/util.js"></script>
		<script type="text/javascript" src="../build/debuggee.js"></script>
		<script type="text/javascript" src="../build/browser.js"></script>
		<script type="text/javascript">

			// console.log('commencing ws test...');
			// var ws = new WebSocket('ws://localhost:8000/debuggee')
			// ws.onclose = function() {
			// 	console.log('close');
			// };
			// ws.onopen = function() {
			// 	console.log('open');
			// }
			// ws.onerror = function() {
			// 	console.log('error');
			// }
			// console.log('listeners initialized...');

			env = new BrowserEnvironment()
			env.start.observe(function() {
				// env.from_event(window, 'load').observe(function() {
					console.log('initializing shit...');
					// do stuff with text field value...
					var formValue = env.from_form_value(document.getElementById('foo'), ['keyup', 'paste']);

					var empty = formValue.map(function(v){return v.length == 0});
					var disabled = empty.map(function(e){return e ? 'disable' : ''});
					env.bind_value(disabled, document.getElementById('send'), 'disabled')

					var windowTitle = formValue.map(function(v) { return v + (empty.value ? '' : ' | ') + 'Reactive Demo' });
					env.bind_value(windowTitle, document, 'title');

					// do stuff with clicks...
					var clicks = env.from_event(document.getElementById('send'), 'click');
					var clickCounter = clicks.fold(0, function(x, evt) { return x+1 });

					clicks.log('clicks');

					env.bind_value(clickCounter, document.getElementById('clickcounter'), 'innerText');

					// do stuff with timer...
					// var ticker = new Ticker(1000);
					// env.bind_value(ticker, document.getElementById('pagetimer'), 'innerText');

				// });
			});

			Debuggee.initialize('ws://localhost:8000/debuggee', env)
							.andthen(function(){
								console.log('hello?');
								env.do_start();
							});
		</script>
	</head>
	<body>
			<input id="foo" type="text" value="foo"/>
			<button id="send">Send Message</button>
		<div>Clicks on sent button: <span id="clickcounter"></span></div>
		<div>Seconds spent on this page: <span id="pagetimer"></span></div>
	</body>
</html>
